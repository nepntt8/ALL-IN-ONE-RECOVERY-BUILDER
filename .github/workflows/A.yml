name: OrangeFox [OFRP]\t\ton:\t\tworkflow_dispatch:\t\t\tinputs:\t\t\t\tMANIFEST_BRANCH:\t\t\t\t\tdescription: 'OrangeFox Branch'\t\t\t\t\trequired: true\t\t\t\t\tdefault: '12.1'\t\t\t\t\ttype: choice\t\t\t\t\toptions: [12.1, 11.0]\t\t\t\tDEVICE_TREE:\t\t\t\t\tdescription: 'Custom Recovery Tree'\t\t\t\t\trequired: true\t\t\t\t\tdefault: ''\t\t\t\tDEVICE_TREE_BRANCH:\t\t\t\t\tdescription: 'Custom Recovery Tree Branch'\t\t\t\t\trequired: true\t\t\t\t\tdefault: ''\t\t\t\tDEVICE_PATH:\t\t\t\t\tdescription: 'Specify your device path.'\t\t\t\t\trequired: true\t\t\t\t\tdefault: 'device/tecno/KJ5'\t\t\t\tDEVICE_NAME:\t\t\t\t\tdescription: 'Specify your Device Codename.'\t\t\t\t\trequired: true\t\t\t\t\tdefault: 'KJ5'\t\t\t\tBUILD_TARGET:\t\t\t\t\tdescription: 'Specify your Build Target'\t\t\t\t\trequired: true\t\t\t\t\tdefault: 'vendorboot'\t\t\t\t\ttype: choice\t\t\t\t\toptions: [boot, recovery, vendorboot]\t\t\t\tLDCHECK:\t\t\t\t\tdescription: 'Path of blobs to check'\t\t\t\t\trequired: true\t\t\t\t\tdefault: 'system/bin/qseecomd'\t\t\t\tRECOVERY_TAR:\t\t\t\t\tdescription: 'Release recovery.tar For Samsung devices'\t\t\t\t\trequired: false\t\t\t\t\tdefault: false\t\t\t\t\ttype: boolean\t\t\t\tRECOVERY_INSTALLER:\t\t\t\t\tdescription: 'Include recovery installer zip'\t\t\t\t\ttype: boolean\t\t\t\t\trequired: true\t\t\t\t\tdefault: true\t\tjobs:\t\tbuild:\t\t\tname: Build OFRP by ${{ github.actor }}\t\t\truns-on: ubuntu-latest\t\t\tif: github.event.repository.owner.id == github.event.sender.id\t\t\tenv:\t\t\t\tGITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\t\t\tpermissions:\t\t\t\tcontents: write\t\t\tsteps:\t\t\t- uses: actions/checkout@v4\t\t\t- run: echo "::group::User Environment Variables
Include Recovery Installer: ${{ inputs.RECOVERY_INSTALLER }}
Release recovery.tar: ${{ inputs.RECOVERY_TAR }}
::endgroup::"\t\t\t- uses: rokibhasansagar/slimhub_actions@main\t\t\t- uses: pierotofy/set-swap-space@v2\t\t\t\twith:\t\t\t\t\tswap-size-gb: 24\t\t\t- run: sudo apt update && sudo apt -y upgrade && rm -rf scripts && git clone https://gitlab.com/OrangeFox/misc/scripts && cd scripts && sudo bash setup/android_build_env.sh\t\t\t- if: contains(fromJSON('["11.0", "12.1"]'), inputs.MANIFEST_BRANCH)\t\t\t\trun: mkdir -p ${GITHUB_WORKSPACE}/OrangeFox && cd ${GITHUB_WORKSPACE}/OrangeFox && git config --global user.name "${{ github.actor }}" && git config --global user.email "${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com" && git clone https://gitlab.com/OrangeFox/sync.git && cd sync && ./orangefox_sync.sh --branch ${{ inputs.MANIFEST_BRANCH }} --path ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}\t\t\t- run: cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }} && git clone ${{ inputs.DEVICE_TREE }} -b ${{ inputs.DEVICE_TREE_BRANCH }} ./${{ inputs.DEVICE_PATH }} && cd ${{ inputs.DEVICE_PATH }} && echo "COMMIT_ID=$(git rev-parse HEAD)" >> $GITHUB_ENV\t\t\t\t\t\t# ðŸ”¥ FLAG 1: Samsung Variant\t\t\t- run: echo "FOX_VARIANT := samsung" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 2: Non-Vanilla Build\t\t\t- run: echo "FOX_VANILLA_BUILD := 0" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 3: AB Device Off\t\t\t- run: echo "FOX_AB_DEVICE := 0" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 4: AVB2.0 Patch\t\t\t- run: echo "OF_PATCH_AVB20 := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 5: GSI Support\t\t\t- run: echo "OF_SUPPORT_GSI_FLASHING := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 6: Nano Editor\t\t\t- run: echo "FOX_USE_NANO_EDITOR := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 7: CryptPolicy\t\t\t- run: echo "OF_CRYPTPOLICY := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 8: 7Zip Fix\t\t\t- run: echo "OF_FIX_7ZIP_ZIP := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAG 9: Green LED\t\t\t- run: echo "OF_USE_GREEN_LED := 1" >> ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk\t\t\t\t\t\t# ðŸ”¥ FLAGS SUMMARY\t\t\t- run: echo "::group::âœ… 9 FLAGS INJECTED
$(tail -10 ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/${{ inputs.DEVICE_PATH }}/BoardConfig.mk)
::endgroup::"\t\t\t\t\t\t# ðŸ”¥ BUILD COMMAND\t\t\t- id: build-cmd\t\t\t\trun: '[[ "${{ inputs.MANIFEST_BRANCH }}" == "11.0" || "${{ inputs.MANIFEST_BRANCH }}" == "12.1" ]] && echo "command=lunch twrp_${{ inputs.DEVICE_NAME }}-eng && make clean && mka adbd ${{ inputs.BUILD_TARGET }}image" >> $GITHUB_OUTPUT || echo "command=lunch omni_${{ inputs.DEVICE_NAME }}-eng && make clean && mka ${{ inputs.BUILD_TARGET }}image" >> $GITHUB_OUTPUT && echo "BUILD_DATE=$(date +%Y%m%d)" >> $GITHUB_ENV\t\t\t- run: cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }} && source build/envsetup.sh && export ALLOW_MISSING_DEPENDENCIES=true && eval "${{ steps.build-cmd.outputs.command }}"\t\t\t- run: 'cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }} && ORANGEFOX_IMG=$(find out/target/product/${{ inputs.DEVICE_NAME }} -name "OrangeFox*.img" | head -1) && [[ -n "$ORANGEFOX_IMG" ]] && echo "CHECK_IMG_IS_OK=true" >> $GITHUB_ENV && echo "FILE_PATH=$(dirname "$ORANGEFOX_IMG")" >> $GITHUB_ENV && echo "MD5_IMG=$(md5sum "$ORANGEFOX_IMG" | cut -d" " -f1)" >> $GITHUB_ENV || echo "CHECK_IMG_IS_OK=false" >> $GITHUB_ENV'\t\t\t- if: env.CHECK_IMG_IS_OK == 'true'\t\t\t\trun: 'cd ${{ env.FILE_PATH }} && [[ "${{ inputs.BUILD_TARGET }}" == "boot" ]] && mv OrangeFox*.img boot.img && echo "RECOVERY_TYPE=boot" >> $GITHUB_ENV || [[ "${{ inputs.BUILD_TARGET }}" == "recovery" ]] && mv OrangeFox*.img recovery.img && echo "RECOVERY_TYPE=recovery" >> $GITHUB_ENV || mv OrangeFox*.img vendor_boot.img && echo "RECOVERY_TYPE=vendor_boot" >> $GITHUB_ENV'\t\t\t- if: env.CHECK_IMG_IS_OK == 'true' && inputs.RECOVERY_INSTALLER == 'true'\t\t\t\trun: cd ${{ env.FILE_PATH }} && wget -q https://github.com/kinguser981/recovery-installer/releases/download/11256427880/recovery-installer.zip && zip -ur recovery-installer.zip ${{ env.RECOVERY_TYPE }}.img\t\t\t- if: env.CHECK_IMG_IS_OK == 'true' && inputs.RECOVERY_TAR == 'true'\t\t\t\trun: cd ${{ env.FILE_PATH }} && tar -cvf ${{ env.RECOVERY_TYPE }}.tar ${{ env.RECOVERY_TYPE }}.img\t\t\t- if: env.CHECK_IMG_IS_OK == 'true'\t\t\t\tuses: softprops/action-gh-release@v2\t\t\t\twith:\t\t\t\t\tfiles: |\t\t\t\t\t\t${{ env.FILE_PATH }}/${{ env.RECOVERY_TYPE }}.img\t\t\t\t\t\t${{ env.FILE_PATH }}/${{ env.RECOVERY_TYPE }}.tar\t\t\t\t\t\t${{ env.FILE_PATH }}/recovery-installer.zip\t\t\t\t\t\t${{ env.FILE_PATH }}/OrangeFox*.zip\t\t\t\t\tname: Unofficial OrangeFox [${{ inputs.DEVICE_NAME }}] - ${{ env.BUILD_DATE }}\t\t\t\t\ttag_name: ${{ github.run_id }}\t\t\t\t\tbody: |\t\t\t\t\t\t## ðŸ—ï¸ Build Information\t\t\t\t\t\t- **Date:** ${{ env.BUILD_DATE }}\t\t\t\t\t\t- **Branch:** ${{ inputs.MANIFEST_BRANCH }}\t\t\t\t\t\t- **Device:** `${{ inputs.DEVICE_NAME }}`\t\t\t\t\t\t- **Target:** `${{ inputs.BUILD_TARGET }}`\t\t\t\t\t\t## âœ… 9 FLAGS ENABLED\t\t\t\t\t\t- FOX_VARIANT := samsung\t\t\t\t\t\t- FOX_VANILLA_BUILD := 0\t\t\t\t\t\t- OF_PATCH_AVB20 := 1\t\t\t\t\t\t- OF_SUPPORT_GSI_FLASHING := 1\t\t\t\t\tprerelease: false\t\t\t\t\tdraft: false\t\t\t- if: env.CHECK_IMG_IS_OK == 'true'\t\t\t\tcontinue-on-error: true\t\t\t\trun: mkdir -p tools && cd tools && wget -q https://github.com/orao/ldcheck/releases/download/v0.1/ldcheck-linux.zip || true && unzip -qo ldcheck-linux.zip 2>/dev/null || true && mv -n libneeds* ${{ env.FILE_PATH }}/ 2>/dev/null || true && mv -n ldcheck ${{ env.FILE_PATH }}/ 2>/dev/null || true && cd ${{ env.FILE_PATH }} && python3 ldcheck -p "system/lib64:vendor/lib64:system/lib:vendor/lib" -d ${{ inputs.LDCHECK }}\t\t\t- if: always()\t\t\t\trun: rm -rf ${GITHUB_WORKSPACE}/OrangeFox scripts && df -h

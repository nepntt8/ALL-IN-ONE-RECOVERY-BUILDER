name: OrangeFox [OFRP] - NON-VANILLA A-ONLY w/ ECHO DEBUG + ECHO BUTTON

on:
  workflow_dispatch:
    inputs:
      MANIFEST_BRANCH:
        description: 'OrangeFox Branch'
        required: true
        default: '12.1'
        type: choice
        options:
        - 12.1
        - 11.0
      DEVICE_TREE:
        description: 'Custom Recovery Tree'
        required: true
        default: ''
      DEVICE_TREE_BRANCH:
        description: 'Custom Recovery Tree Branch'
        required: true
        default: ''
      DEVICE_PATH:
        description: 'Specify your device path.'
        required: true
        default: 'device/samsung/m14x'
      DEVICE_NAME:
        description: 'Specify your Device Codename.'
        required: true
        default: 'm14x'
      BUILD_TARGET:
        description: 'Specify your Build Target'
        required: true
        default: 'recovery'
        type: choice
        options:
        - boot
        - recovery
        - vendorboot
      LDCHECK:
        description: 'Path of blobs to check' 
        required: true
        default: 'system/bin/qseecomd'
      RECOVERY_TAR:
        description: 'Release recovery.tar For Samsung devices'
        required: false
        default: true
        type: boolean
      RECOVERY_INSTALLER:
        description: 'Include recovery installer zip'
        type: boolean
        required: true
        default: true
      # ðŸ”¥ NON-VANILLA FLAGS
      NON_VANILLA:
        description: 'Non-Vanilla Build (GSI/AVB/CRB)'
        required: false
        default: true
        type: boolean
      A_ONLY:
        description: 'A-Only Device (No A/B)'
        required: false
        default: true
        type: boolean
      SAMSUNG_VARIANT:
        description: 'Samsung Variant'
        required: false
        default: true
        type: boolean
      # ðŸ”¥ ECHO DEBUG BUTTON
      ECHO_DEBUG:
        description: 'ECHO Flags Only (No Real Flags) - DEBUG MODE'
        required: false
        default: false
        type: boolean

jobs:
  build:
    name: Build NON-VANILLA OFRP by ${{ github.actor }}
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    permissions:
      contents: write
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Display Inputs + Flags
      run: |
        echo "=== NON-VANILLA FLAGS ==="
        echo "Non-Vanilla: ${{ github.event.inputs.NON_VANILLA }}"
        echo "A-Only: ${{ github.event.inputs.A_ONLY }}"
        echo "Samsung: ${{ github.event.inputs.SAMSUNG_VARIANT }}"
        echo "ECHO DEBUG: ${{ github.event.inputs.ECHO_DEBUG }}"
        echo "Manifest: ${{ github.event.inputs.MANIFEST_BRANCH }}"
        echo "Device: ${{ github.event.inputs.DEVICE_NAME }}"

    # ... [Keep all previous steps unchanged until INJECT FLAGS] ...

    - name: ðŸ”¥ INJECT FLAGS (${{ github.event.inputs.ECHO_DEBUG && 'ECHO MODE' || 'REAL MODE' }})
      run: |
        echo "âš™ï¸  Injecting flags - MODE: ${{ github.event.inputs.ECHO_DEBUG && 'ECHO DEBUG' || 'REAL FLAGS' }}..."
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ github.event.inputs.MANIFEST_BRANCH }}/${{ github.event.inputs.DEVICE_PATH }}
        
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "ECHO MODE: No real flags written!"' || 'cat >> BoardConfig.mk << EOF' }}
        
        # ðŸ”¥ NON-VANILLA ORANGEFOX FLAGS (A-Only Samsung M14x)
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_VARIANT := samsung"' || 'FOX_VARIANT := samsung' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_VANILLA_BUILD := 0"' || 'FOX_VANILLA_BUILD := 0' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_USE_TWRP_RECOVERY_IMAGE_BUILDER := 1"' || 'FOX_USE_TWRP_RECOVERY_IMAGE_BUILDER := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_USE_BASH_SHELL := 1"' || 'FOX_USE_BASH_SHELL := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_USE_NANO_EDITOR := 1"' || 'FOX_USE_NANO_EDITOR := 1' }}

        # A-Only (CRITICAL for M14x)
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "FOX_AB_DEVICE := 0"' || 'FOX_AB_DEVICE := 0' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_VIRTUAL_AB_DEVICE := 0"' || 'OF_VIRTUAL_AB_DEVICE := 0' }}

        # AVB + GSI + CRB
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_PATCH_AVB20 := 1"' || 'OF_PATCH_AVB20 := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_SUPPORT_GSI_FLASHING := 1"' || 'OF_SUPPORT_GSI_FLASHING := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_NO_TREBLE_COMPATIBILITY_CHECK := 1"' || 'OF_NO_TREBLE_COMPATIBILITY_CHECK := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_CRYPTPOLICY := 1"' || 'OF_CRYPTPOLICY := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_FIX_7ZIP_ZIP := 1"' || 'OF_FIX_7ZIP_ZIP := 1' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "OF_ALLOW_NEW_PARTITION_SCHEME := 1"' || 'OF_ALLOW_NEW_PARTITION_SCHEME := 1' }}

        # Samsung M14x Specific
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "TARGET_SCREEN_DENSITY := 400"' || 'TARGET_SCREEN_DENSITY := 400' }}
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "BOARD_KERNEL_CMDLINE += androidboot.selinux=permissive"' || 'BOARD_KERNEL_CMDLINE += androidboot.selinux=permissive' }}
        
        ${{ github.event.inputs.ECHO_DEBUG && 'echo "EOF"' || 'EOF' }}
        
        echo "âœ… Flags injected (${{ github.event.inputs.ECHO_DEBUG && 'ECHO MODE' || 'REAL MODE' }})!"

    - name: Building OrangeFox NON-VANILLA
      run: |
        echo "ðŸ”¨ Starting NON-VANILLA build..."
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ github.event.inputs.MANIFEST_BRANCH }}
        source build/envsetup.sh
        export ALLOW_MISSING_DEPENDENCIES=true
        
        echo "ðŸ“¤ Exporting environment flags..."
        export FOX_VARIANT=samsung
        export FOX_VANILLA_BUILD=0
        export FOX_AB_DEVICE=0
        export OF_PATCH_AVB20=1
        export OF_SUPPORT_GSI_FLASHING=1
        export OF_CRYPTPOLICY=1
        export FOX_USE_NANO_EDITOR=1
        
        echo "ðŸ½ï¸ Lunch: twrp_${{ github.event.inputs.DEVICE_NAME }}-eng"
        lunch twrp_${{ github.event.inputs.DEVICE_NAME }}-eng
        
        echo "ðŸ§¹ Cleaning previous builds..."
        make clean
        
        echo "ðŸš€ Building ${{ github.event.inputs.BUILD_TARGET }}image..."
        mka ${{ github.event.inputs.BUILD_TARGET }}image -j$(nproc --all)
        echo "âœ… NON-VANILLA A-Only OFRP COMPLETE!"

    # ... [Keep rest unchanged] ...
